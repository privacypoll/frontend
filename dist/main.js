(()=>{"use strict";function t(t,e){if(!(BigInt(0)<=t&&t<e))throw new Error("a not in range");return!0}function e(t){return t.toString(2).length}function r(t){return t%BigInt(2)===BigInt(1)}function n(t,e){let r=t%e;return r<BigInt(0)&&(r=(r+e)%e),r}function o(t,e,n){if(e<BigInt(0))throw new Error("neg expo");let o=BigInt(1),i=t,s=e;for(;s>BigInt(0);)r(s)&&(o=o*i%n),i=i*i%n,s/=BigInt(2);return o}function i(t,e){return function(t,e){let r=function(t,e){let r=BigInt(1),n=BigInt(0),o=BigInt(0),i=BigInt(1),s=t,a=e,c=BigInt(0);for(;a!=BigInt(0);){const t=s/a;r-=o*t,n-=i*t,s-=t*a,c=s,s=a,a=c,c=r,r=o,o=c,c=n,n=i,i=c}return{g:s,a:r,b:n}}(t,e).a;return r<0&&(r+=e),r}(t,e)}function s(t,e){const r=BigInt(1)<<BigInt(8)*BigInt(e);if(!(e>0&&BigInt(0)<=t&&t<r))throw new Error("number doesn't fit in array");const n=new Uint8Array(e);let o=t;for(let t=0;t<e;t++){const r=o&BigInt(255);n[e-1-t]=parseInt(r.toString()),o>>=BigInt(8)}return n}function a(t){let e=BigInt(0);for(const r of t)e<<=BigInt(8),e|=BigInt(r);return e}function c(t){const r=new Uint8Array(function(t){return Math.ceil(e(t)/8)}(t));for(;;){crypto.getRandomValues(r);const e=a(r);if(e<t)return e}}const u={isRequired:!0,serializer:function(t){let e="0x";return t<BigInt(0)&&(t=-t,e="-"+e),e+t.toString(16)},deserializer:function(t){if(!t)throw new Error(`the field ${this.key} is required`);return"-"===t.charAt(0)?-BigInt(t.slice(1)):BigInt(t)}};var l=function(t,e){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},l(t,e)};function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var f=function(){return f=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},f.apply(this,arguments)};function y(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var d=function(){function t(t){this.ctor=t}return t.prototype.getTypes=function(){return[this.ctor]},t.prototype.hasFriendlyName=function(){return"Object"!==this.ctor.name},t}(),h=function(t){function e(e){return t.call(this,e)||this}return p(e,t),e}(d),g=function(t){function e(e){return t.call(this,e)||this}return p(e,t),e}(d),w=function(t){function e(e){var r=t.call(this,Array)||this;return r.elementType=e,r}return p(e,t),e.prototype.getTypes=function(){return t.prototype.getTypes.call(this).concat(this.elementType.getTypes())},e}(g),v=function(t){function e(e){var r=t.call(this,Set)||this;return r.elementType=e,r}return p(e,t),e.prototype.getTypes=function(){return t.prototype.getTypes.call(this).concat(this.elementType.getTypes())},e}(g);function m(t){return new v(T(t))}var b=function(t){function e(e,r,n){var o=t.call(this,Map)||this;return o.keyType=e,o.valueType=r,o.options=n,o}return p(e,t),e.prototype.getTypes=function(){return t.prototype.getTypes.call(this).concat(this.keyType.getTypes(),this.valueType.getTypes())},e.prototype.getCompleteOptions=function(){var t,e;return{shape:null!==(e=null===(t=this.options)||void 0===t?void 0:t.shape)&&void 0!==e?e:0}},e}(g);function S(t,e,r){return new b(T(t),T(e),r)}var z=new h((function(){}));function A(t){return"function"==typeof t&&""===t.name}function T(t){return t instanceof d?t:new h(t)}function P(t,e){if(null==t)throw new Error("No type given on "+e+". "+R);return A(t)?t:function(){return t}}var R="If the type is not yet defined, for example due to circular references, add '() => ' before it. E.g. @jsonMember(() => Foo)",E='Make sure that you have both "experimentalDecorators" and "emitDecoratorMetadata" enabled in your tsconfig.json';function _(t,e){return"string"!=typeof t||function(t,e){var r=e===String||e===ArrayBuffer||e===DataView,n=t.length>=2&&'"'===t[0]&&'"'===t[t.length-1];if(e===Date){var o=!isNaN(Number(t.trim()));return!n&&!o}return r&&!n}(t,e)?t:JSON.parse(t)}function B(t,e){return t===e||t.prototype instanceof e}function I(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];"object"==typeof console&&"function"==typeof console.error?console.error.apply(console,y([t],e)):"object"==typeof console&&"function"==typeof console.log&&console.log.apply(console,y(["ERROR: "+t],e))}function k(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];"object"==typeof console&&"function"==typeof console.warn?console.warn.apply(console,y([t],e)):"object"==typeof console&&"function"==typeof console.log&&console.log.apply(console,y(["WARNING: "+t],e))}function q(t){return!(null==t)}function x(t,e){return e===z.ctor||("number"==typeof t?e===Number:"string"==typeof t?e===String:"boolean"==typeof t?e===Boolean:!!function(t){return"object"==typeof t}(t)&&t instanceof e)}var C="object"==typeof Reflect&&"function"==typeof Reflect.getMetadata;function j(t){return"string"==typeof t.name?t.name:"undefined"}function O(t){return t}var M="__typedJsonJsonObjectMetadataInformation__",H=function(){function t(t){this.dataMembers=new Map,this.knownTypes=new Set,this.knownTypesDeferred=[],this.isExplicitlyMarked=!1,this.isHandledWithoutAnnotation=!1,this.classType=t}return t.getJsonObjectName=function(e){var r=t.getFromConstructor(e);return j(void 0===r?e:r.classType)},t.getFromConstructor=function(e){var r=e.prototype;if(null!=r){var n;if(Object.prototype.hasOwnProperty.call(r,M)&&(n=r[M]),!0===(null==n?void 0:n.isExplicitlyMarked))return n;if(t.doesHandleWithoutAnnotation(e)){var o=new t(e);return o.isExplicitlyMarked=!0,o}}},t.ensurePresentInPrototype=function(e){if(Object.prototype.hasOwnProperty.call(e,M))return e[M];var r=new t(e.constructor),n=e[M];return void 0!==n&&(n.dataMembers.forEach((function(t,e){r.dataMembers.set(e,t)})),n.knownTypes.forEach((function(t){r.knownTypes.add(t)})),r.typeResolver=n.typeResolver,r.typeHintEmitter=n.typeHintEmitter),Object.defineProperty(e,M,{enumerable:!1,configurable:!1,writable:!1,value:r}),r},t.getKnownTypeNameFromType=function(e){var r=t.getFromConstructor(e);return j(void 0===r?e:r.classType)},t.doesHandleWithoutAnnotation=function(t){return-1!==[Date,Number,String,Boolean].indexOf(t)||-1!==[Float32Array,Float64Array,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array].indexOf(t)||t===DataView||t===ArrayBuffer},t.prototype.processDeferredKnownTypes=function(){var t=this;this.knownTypesDeferred.forEach((function(e){e().getTypes().forEach((function(e){return t.knownTypes.add(e)}))})),this.knownTypesDeferred=[]},t}();function N(t,e,r){var n="@jsonMember on "+j(t.constructor)+"."+String(e);if("function"!=typeof t)if("function"!=typeof t[e])if(null==r||void 0===r.type&&void 0===r.deserializer)I(n+": JsonMemberMetadata has unknown type.");else{var o=H.ensurePresentInPrototype(t);void 0===r.deserializer&&o.knownTypesDeferred.push(r.type),Object.keys(r).forEach((function(t){return void 0===r[t]&&delete r[t]})),o.dataMembers.set(r.name,r)}else I(n+": cannot use a method property.");else I(n+": cannot use a static property.")}var D=["preserveNull"];function V(t){var e=Object.keys(t).filter((function(t){return D.indexOf(t)>-1})).reduce((function(e,r){return e[r]=t[r],e}),{});return Object.keys(e).length>0?e:void 0}function K(t,e){return null!=e&&null!=e[t]?e[t]:function(t){return"preserveNull"!==t&&null}(t)}function J(t,e){return null==e?t:f(f({},t),e)}function F(t,e){if(null!=t.__type)return e.get(t.__type)}var U=function(){function t(){this.typeResolver=F,this.errorHandler=I,this.deserializationStrategy=new Map([[z.ctor,O],[Number,L],[String,L],[Boolean,L],[Date,Z],[ArrayBuffer,tt],[DataView,et],[Array,X],[Set,Y],[Map,Q],[Float32Array,nt],[Float64Array,nt],[Uint8Array,ot],[Uint8ClampedArray,ot],[Uint16Array,ot],[Uint32Array,ot]])}return t.prototype.setDeserializationStrategy=function(t,e){this.deserializationStrategy.set(t,e)},t.prototype.setNameResolver=function(t){this.nameResolver=t},t.prototype.setTypeResolver=function(t){if("function"!=typeof t)throw new TypeError("'typeResolverCallback' is not a function.");this.typeResolver=t},t.prototype.getTypeResolver=function(){return this.typeResolver},t.prototype.setErrorHandler=function(t){if("function"!=typeof t)throw new TypeError("'errorHandlerCallback' is not a function.");this.errorHandler=t},t.prototype.getErrorHandler=function(){return this.errorHandler},t.prototype.convertSingleValue=function(t,e,r,n,o){if(void 0===n&&(n="object"),this.retrievePreserveNull(o)&&null===t)return null;if(q(t)){var i=this.deserializationStrategy.get(e.ctor);if(void 0!==i)return i(t,e,r,n,this,o);if("object"==typeof t)return function(t,e,r,n,o){if("object"==typeof t&&null!==t){var i=e.ctor,s=H.getFromConstructor(i),a=r,c=o.getTypeResolver();void 0!==s&&(s.processDeferredKnownTypes(),a=o.mergeKnownTypes(a,o.createKnownTypesMap(s.knownTypes)),null!=s.typeResolver&&(c=s.typeResolver));var u=c(t,a);if(null!=u&&B(u,i)&&(i=u,void 0!==(s=H.getFromConstructor(u))&&(a=o.mergeKnownTypes(a,o.createKnownTypesMap(s.knownTypes)))),!0===(null==s?void 0:s.isExplicitlyMarked)){var l=s,p={},f=J(o.options,l.options);l.dataMembers.forEach((function(e,n){var i,s=t[n],c=j(l.classType)+"."+n,u=J(f,e.options);if(null!=e.deserializer)i=e.deserializer(s,{fallback:function(t,e){return o.convertSingleValue(t,T(e),r)}});else{if(null==e.type)throw new TypeError("Cannot deserialize "+c+" there is no constructor nor deserialization function to use.");i=o.convertSingleValue(s,e.type(),a,c,u)}q(i)||o.retrievePreserveNull(u)&&null===i?p[e.key]=i:!0===e.isRequired&&o.getErrorHandler()(new TypeError("Missing required member '"+c+"'."))}));var y=void 0;if("function"==typeof s.initializerCallback)try{if(null==(y=s.initializerCallback(p,t)))throw new TypeError("Cannot deserialize "+n+": 'initializer' function returned undefined/null, but '"+j(s.classType)+"' was expected.");if(!(y instanceof s.classType))throw new TypeError("Cannot deserialize "+n+":'initializer' returned '"+j(y.constructor)+"', but '"+j(s.classType)+"' was expected, and '"+j(y.constructor)+"' is not a subtype of '"+j(s.classType)+"'")}catch(t){return void o.getErrorHandler()(t)}else y=o.instantiateType(i);Object.assign(y,p);var d=s.onDeserializedMethodName;return null!=d&&("function"==typeof y[d]?y[d]():"function"==typeof y.constructor[d]?y.constructor[d]():o.getErrorHandler()(new TypeError("onDeserialized callback'"+j(s.classType)+"."+d+"' is not a method."))),y}var g={};return Object.keys(t).forEach((function(e){g[e]=o.convertSingleValue(t[e],new h(t[e].constructor),r,e)})),g}o.getErrorHandler()(new TypeError("Cannot deserialize "+n+": 'sourceObject' must be a defined object."))}(t,e,r,n,this);var s="Could not deserialize '"+n+"'; don't know how to deserialize type";e.hasFriendlyName()&&(s+=" '"+e.ctor.name+"'"),this.errorHandler(new TypeError(s+"."))}},t.prototype.instantiateType=function(t){return new t},t.prototype.mergeKnownTypes=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=new Map;return e.forEach((function(e){e.forEach((function(e,r){void 0===t.nameResolver?n.set(r,e):n.set(t.nameResolver(e),e)}))})),n},t.prototype.createKnownTypesMap=function(t){var e=this,r=new Map;return t.forEach((function(t){if(void 0===e.nameResolver){var n=H.getFromConstructor(t),o=!0===(null==n?void 0:n.isExplicitlyMarked)?n.name:null;r.set(null!=o?o:t.name,t)}else r.set(e.nameResolver(t),t)})),r},t.prototype.retrievePreserveNull=function(t){return K("preserveNull",J(this.options,t))},t}();function G(t,e,r,n){throw new TypeError("Could not deserialize "+n+" as "+t+": expected "+e+", got "+r+".")}function W(t,e,r){return"Could not deserialize "+r+": expected '"+("function"==typeof t?j(t):t)+"', got '"+("function"==typeof e?j(e):e)+"'."}function $(t){return null==t?"undefined":j(t.constructor)}function L(t,e,r,n){if(t.constructor!==e.ctor)throw new TypeError(W(j(e.ctor),t.constructor,n));return t}function X(t,e,r,n,o,i){if(!(e instanceof w))throw new TypeError("Could not deserialize "+n+" as Array: incorrect TypeDescriptor detected, please use proper annotation or function for this type");return Array.isArray(t)?null==e.elementType?(o.getErrorHandler()(new TypeError("Could not deserialize "+n+" as Array: missing constructor reference of Array elements.")),[]):t.map((function(t,s){try{return o.convertSingleValue(t,e.elementType,r,n+"["+s+"]",i)}catch(t){return void o.getErrorHandler()(t)}})):(o.getErrorHandler()(new TypeError(W(Array,t.constructor,n))),[])}function Y(t,e,r,n,o,i){if(!(e instanceof v))throw new TypeError("Could not deserialize "+n+" as Set: incorrect TypeDescriptor detected, please use proper annotation or function for this type");if(!Array.isArray(t))return o.getErrorHandler()(new TypeError(W(Array,t.constructor,n))),new Set;if(null==e.elementType)return o.getErrorHandler()(new TypeError("Could not deserialize "+n+" as Set: missing constructor reference of Set elements.")),new Set;var s=new Set;return t.forEach((function(t,a){try{s.add(o.convertSingleValue(t,e.elementType,r,n+"["+a+"]",i))}catch(t){o.getErrorHandler()(t)}})),s}function Q(t,e,r,n,o,i){if(!(e instanceof b))throw new TypeError("Could not deserialize "+n+" as Map: incorrect TypeDescriptor detected,please use proper annotation or function for this type");var s=e.getCompleteOptions().shape;if(!function(t,e){return 0===e&&Array.isArray(t)||1===e&&"object"==typeof t}(t,s)){var a=0===s?Array:Object;return o.getErrorHandler()(new TypeError(W(a,t.constructor,n))),new Map}if(null==e.keyType)return o.getErrorHandler()(new TypeError("Could not deserialize "+n+" as Map: missing key constructor.")),new Map;if(null==e.valueType)return o.getErrorHandler()(new TypeError("Could not deserialize "+n+" as Map: missing value constructor.")),new Map;var c=n+"[].key",u=n+"[].value",l=new Map;return 1===s?Object.keys(t).forEach((function(n){try{var s=o.convertSingleValue(n,e.keyType,r,c,i);q(s)&&l.set(s,o.convertSingleValue(t[n],e.valueType,r,u,i))}catch(t){o.getErrorHandler()(t)}})):t.forEach((function(t){try{var n=o.convertSingleValue(t.key,e.keyType,r,c,i);q(n)&&l.set(n,o.convertSingleValue(t.value,e.valueType,r,u,i))}catch(t){o.getErrorHandler()(t)}})),l}function Z(t,e,r,n){if("number"==typeof t){if(t%1!=0)throw new TypeError("Could not deserialize "+n+" as Date: expected an integer, got a number with decimal places.");return new Date(t)}return"string"==typeof t?new Date(t):t instanceof Date?t:void G("Date","an ISO-8601 string",$(t),n)}function tt(t,e,r,n){return"string"!=typeof t&&G("ArrayBuffer","a string source",$(t),n),rt(t)}function et(t,e,r,n){return"string"!=typeof t&&G("DataView","a string source",$(t),n),new DataView(rt(t))}function rt(t){for(var e=new ArrayBuffer(2*t.length),r=new Uint16Array(e),n=0,o=t.length;n<o;n++)r[n]=t.charCodeAt(n);return e}function nt(t,e,r,n){var o=e.ctor;return Array.isArray(t)&&t.every((function(t){return!isNaN(t)}))?new o(t):G(o.name,"a numeric source array",$(t),n)}function ot(t,e,r,n){var o=e.ctor;return Array.isArray(t)&&t.every((function(t){return!isNaN(t)}))?new o(t.map((function(t){return~~t}))):G(e.ctor.name,"a numeric source array",$(t),n)}function it(t,e){return void 0===e&&(e={}),function(r,n){var o,i="@jsonArrayMember on "+j(r.constructor)+"."+String(n),s=P(t,i),a=null==e.dimensions?1:e.dimensions;if(!isNaN(a)&&a<1)I(i+": 'dimensions' option must be at least 1.");else{var c=C?Reflect.getMetadata("design:type",r,n):null;null==c||c===Array||c===Object?N(r,n,{type:function(){return st(T(s()),a)},emitDefaultValue:e.emitDefaultValue,isRequired:e.isRequired,options:V(e),key:n.toString(),name:null!==(o=e.name)&&void 0!==o?o:n.toString(),deserializer:e.deserializer,serializer:e.serializer}):I(i+": property is not an Array. "+E)}}}function st(t,e){for(var r=new w(t),n=1;n<e;++n)r=new w(r);return r}function at(t,e,r,n){var o;e.constructor!==r&&(t.__type=null!==(o=null==n?void 0:n.name)&&void 0!==o?o:j(e.constructor))}var ct=function(){function t(){this.typeHintEmitter=at,this.errorHandler=I,this.serializationStrategy=new Map([[z.ctor,O],[Date,O],[Number,O],[String,O],[Boolean,O],[ArrayBuffer,yt],[DataView,dt],[Array,ut],[Set,lt],[Map,pt],[Float32Array,ft],[Float64Array,ft],[Int8Array,ft],[Uint8Array,ft],[Uint8ClampedArray,ft],[Int16Array,ft],[Uint16Array,ft],[Int32Array,ft],[Uint32Array,ft]])}return t.prototype.setSerializationStrategy=function(t,e){this.serializationStrategy.set(t,e)},t.prototype.setTypeHintEmitter=function(t){if("function"!=typeof t)throw new TypeError("'typeEmitterCallback' is not a function.");this.typeHintEmitter=t},t.prototype.getTypeHintEmitter=function(){return this.typeHintEmitter},t.prototype.setErrorHandler=function(t){if("function"!=typeof t)throw new TypeError("'errorHandlerCallback' is not a function.");this.errorHandler=t},t.prototype.getErrorHandler=function(){return this.errorHandler},t.prototype.retrievePreserveNull=function(t){return K("preserveNull",J(this.options,t))},t.prototype.convertSingleValue=function(t,e,r,n){if(void 0===r&&(r="object"),this.retrievePreserveNull(n)&&null===t)return null;if(q(t))if(x(t,e.ctor)){var o=this.serializationStrategy.get(e.ctor);if(void 0!==o)return o(t,e,r,this,n);if("object"==typeof t)return function(t,e,r,n,o){var i,s,a=n.getTypeHintEmitter();if(void 0===(i=t.constructor!==e.ctor&&t instanceof e.ctor?H.getFromConstructor(t.constructor):H.getFromConstructor(e.ctor)))s=f({},t);else{var c=i.beforeSerializationMethodName;null!=c&&("function"==typeof t[c]?t[c]():"function"==typeof t.constructor[c]?t.constructor[c]():n.getErrorHandler()(new TypeError("beforeSerialization callback '"+j(i.classType)+"."+c+"' is not a method.")));var u=i;s={};var l=J(n.options,u.options);null!=u.typeHintEmitter&&(a=u.typeHintEmitter),u.dataMembers.forEach((function(e){var r,o=J(l,e.options);if(null!=e.serializer)r=e.serializer(t[e.key],{fallback:function(t,e){return n.convertSingleValue(t,T(e))}});else{if(null==e.type)throw new TypeError("Could not serialize "+e.name+", there is no constructor nor serialization function to use.");r=n.convertSingleValue(t[e.key],e.type(),j(u.classType)+"."+e.key,o)}(n.retrievePreserveNull(o)&&null===r||q(r))&&(s[e.name]=r)}))}return a(s,t,e.ctor,i),s}(t,e,0,this);var i="Could not serialize '"+r+"'; don't know how to serialize type";e.hasFriendlyName()&&(i+=" '"+e.ctor.name+"'"),this.errorHandler(new TypeError(i+"."))}else{var s=j(e.ctor),a=j(t.constructor);this.errorHandler(new TypeError("Could not serialize '"+r+"': expected '"+s+"', got '"+a+"'."))}},t}();function ut(t,e,r,n,o){if(!(e instanceof w))throw new TypeError("Could not serialize "+r+" as Array: incorrect TypeDescriptor detected, please use proper annotation or function for this type");if(null==e.elementType)throw new TypeError("Could not serialize "+r+" as Array: missing element type definition.");return t.forEach((function(t,i){if(!(n.retrievePreserveNull(o)&&null===t||x(t,e.elementType.ctor))){var s=j(e.elementType.ctor),a=t&&j(t.constructor);throw new TypeError("Could not serialize "+r+"["+i+"]: expected '"+s+"', got '"+a+"'.")}})),t.map((function(t,i){return n.convertSingleValue(t,e.elementType,r+"["+i+"]",o)}))}function lt(t,e,r,n,o){if(!(e instanceof v))throw new TypeError("Could not serialize "+r+" as Set: incorrect TypeDescriptor detected, please use proper annotation or function for this type");if(null==e.elementType)throw new TypeError("Could not serialize "+r+" as Set: missing element type definition.");r+="[]";var i=[];return t.forEach((function(t){var s=n.convertSingleValue(t,e.elementType,r,o);q(t)&&!q(s)||i.push(s)})),i}function pt(t,e,r,n,o){if(!(e instanceof b))throw new TypeError("Could not serialize "+r+" as Map: incorrect TypeDescriptor detected, please use proper annotation or function for this type");if(null==e.valueType)throw new TypeError("Could not serialize "+r+" as Map: missing value type definition.");if(null==e.keyType)throw new TypeError("Could not serialize "+r+" as Map: missing key type definition.");var i=r+"[].key",s=r+"[].value",a=e.getCompleteOptions().shape,c=1===a?{}:[],u=n.retrievePreserveNull(o);return t.forEach((function(t,r){var l={key:n.convertSingleValue(r,e.keyType,i,o),value:n.convertSingleValue(t,e.valueType,s,o)},p=q(l.key),f=null===l.value&&u||q(l.value);p&&f&&(1===a?c[l.key]=l.value:c.push(l))})),c}function ft(t){return Array.from(t)}function yt(t){return Array.from(new Uint16Array(t)).map((function(t){return String.fromCharCode(t)})).join("")}function dt(t){return yt(t.buffer)}var ht=function(){function t(t,e){this.serializer=new ct,this.deserializer=new U,this.globalKnownTypes=[],this.indent=0;var r=H.getFromConstructor(t);if(void 0===r||!r.isExplicitlyMarked&&!r.isHandledWithoutAnnotation)throw new TypeError("The TypedJSON root data type must have the @jsonObject decorator used.");this.nameResolver=function(t){return j(t)},this.rootConstructor=t,this.errorHandler=function(t){return I(t)},this.config(e)}return t.parse=function(e,r,n){return new t(r,n).parse(e)},t.parseAsArray=function(e,r,n,o){return new t(r,n).parseAsArray(e,o)},t.parseAsSet=function(e,r,n){return new t(r,n).parseAsSet(e)},t.parseAsMap=function(e,r,n,o){return new t(n,o).parseAsMap(e,r)},t.toPlainJson=function(e,r,n){return new t(r,n).toPlainJson(e)},t.toPlainArray=function(e,r,n,o){return new t(r,o).toPlainArray(e,n)},t.toPlainSet=function(e,r,n){return new t(r,n).toPlainSet(e)},t.toPlainMap=function(e,r,n,o){return new t(n,o).toPlainMap(e,r)},t.stringify=function(e,r,n){return new t(r,n).stringify(e)},t.stringifyAsArray=function(e,r,n,o){return new t(r,o).stringifyAsArray(e,n)},t.stringifyAsSet=function(e,r,n){return new t(r,n).stringifyAsSet(e)},t.stringifyAsMap=function(e,r,n,o){return new t(n,o).stringifyAsMap(e,r)},t.setGlobalConfig=function(t){Object.assign(this._globalConfig,t)},t.mapType=function(t,e){null==this._globalConfig.mappedTypes&&(this._globalConfig.mappedTypes=new Map),this._globalConfig.mappedTypes.set(t,e)},t.prototype.config=function(e){var r=this;null!=(e=f(f({},t._globalConfig),e)).knownTypes&&null!=t._globalConfig.knownTypes&&(e.knownTypes=Array.from(new Set(e.knownTypes.concat(t._globalConfig.knownTypes))));var n=V(e);this.serializer.options=n,this.deserializer.options=n,null!=e.errorHandler&&(this.errorHandler=e.errorHandler,this.deserializer.setErrorHandler(e.errorHandler),this.serializer.setErrorHandler(e.errorHandler)),null!=e.replacer&&(this.replacer=e.replacer),null!=e.typeResolver&&this.deserializer.setTypeResolver(e.typeResolver),null!=e.typeHintEmitter&&this.serializer.setTypeHintEmitter(e.typeHintEmitter),null!=e.indent&&(this.indent=e.indent),null!=e.mappedTypes&&e.mappedTypes.forEach((function(t,e){r.setSerializationStrategies(e,t)})),null!=e.nameResolver&&(this.nameResolver=e.nameResolver,this.deserializer.setNameResolver(e.nameResolver)),null!=e.knownTypes&&(e.knownTypes.forEach((function(t,e){null==t&&k("TypedJSON.config: 'knownTypes' contains an undefined/null value (element "+e+").")})),this.globalKnownTypes=e.knownTypes)},t.prototype.mapType=function(t,e){this.setSerializationStrategies(t,e)},t.prototype.parse=function(t){var e,r=_(t,this.rootConstructor);try{e=this.deserializer.convertSingleValue(r,T(this.rootConstructor),this.getKnownTypes())}catch(t){this.errorHandler(t)}return e},t.prototype.parseAsArray=function(t,e){void 0===e&&(e=1);var r=_(t,Array);return this.deserializer.convertSingleValue(r,st(T(this.rootConstructor),e),this._mapKnownTypes(this.globalKnownTypes))},t.prototype.parseAsSet=function(t){var e=_(t,Set);return this.deserializer.convertSingleValue(e,m(this.rootConstructor),this._mapKnownTypes(this.globalKnownTypes))},t.prototype.parseAsMap=function(t,e){var r=_(t,Map);return this.deserializer.convertSingleValue(r,S(e,this.rootConstructor),this._mapKnownTypes(this.globalKnownTypes))},t.prototype.toPlainJson=function(t){try{return this.serializer.convertSingleValue(t,T(this.rootConstructor))}catch(t){this.errorHandler(t)}},t.prototype.toPlainArray=function(t,e){void 0===e&&(e=1);try{return this.serializer.convertSingleValue(t,st(T(this.rootConstructor),e))}catch(t){this.errorHandler(t)}},t.prototype.toPlainSet=function(t){try{return this.serializer.convertSingleValue(t,m(this.rootConstructor))}catch(t){this.errorHandler(t)}},t.prototype.toPlainMap=function(t,e){try{return this.serializer.convertSingleValue(t,S(e,this.rootConstructor))}catch(t){this.errorHandler(t)}},t.prototype.stringify=function(t){var e=this.toPlainJson(t);return void 0===e?"":JSON.stringify(e,this.replacer,this.indent)},t.prototype.stringifyAsArray=function(t,e){return JSON.stringify(this.toPlainArray(t,e),this.replacer,this.indent)},t.prototype.stringifyAsSet=function(t){return JSON.stringify(this.toPlainSet(t),this.replacer,this.indent)},t.prototype.stringifyAsMap=function(t,e){return JSON.stringify(this.toPlainMap(t,e),this.replacer,this.indent)},t.prototype.getKnownTypes=function(){var t=this,e=H.getFromConstructor(this.rootConstructor),r=new Map;return this.globalKnownTypes.filter((function(t){return t})).forEach((function(e){r.set(t.nameResolver(e),e)})),void 0!==e&&(e.processDeferredKnownTypes(),e.knownTypes.forEach((function(e){r.set(t.nameResolver(e),e)}))),r},t.prototype._mapKnownTypes=function(t){var e=this,r=new Map;return t.filter((function(t){return t})).forEach((function(t){return r.set(e.nameResolver(t),t)})),r},t.prototype.setSerializationStrategies=function(t,e){var r=this;null!=e.deserializer&&this.deserializer.setDeserializationStrategy(t,(function(t){return e.deserializer(t,{fallback:function(t,e){return r.deserializer.convertSingleValue(t,T(e),r.getKnownTypes())}})})),null!=e.serializer&&this.serializer.setSerializationStrategy(t,(function(t){return e.serializer(t,{fallback:function(t,e){return r.serializer.convertSingleValue(t,T(e))}})}))},t._globalConfig={},t}();function gt(t){if("function"!=typeof t)return function(e){wt(e,t)};wt(t,{})}function wt(t,e){if(!0!==e.overwrite&&void 0!==t.prototype.toJSON)throw new Error(t.name+" already has toJSON defined!");t.prototype.toJSON=function(){return ht.toPlainJson(this,Object.getPrototypeOf(this).constructor)}}function vt(t,e){var r,n;if("string"!=typeof e&&"symbol"!=typeof e)return r=t,n=e,function(t,e){var o,i,s,a="@jsonMember on "+j(t.constructor)+"."+String(e);if(null!=(s=r)&&("function"==typeof s||s instanceof d)||A(r)?i=P(r,a):n=r,n=null!=n?n:{},Object.prototype.hasOwnProperty.call(n,"constructor")){if(void 0!==i)throw new Error("Cannot both define constructor option and type. Only one allowed.");if(!q(n.constructor))return void I(a+": cannot resolve specified property constructor at runtime. "+R);var c=T(n.constructor);i=function(){return c},C&&!B(c.ctor,Reflect.getMetadata("design:type",t,e))&&k(a+": detected property type does not match 'constructor' option.")}else if(void 0!==i);else if(C){var u=Reflect.getMetadata("design:type",t,e);if(null==u)return void I(a+": cannot resolve detected property constructor at runtime. "+R);i=function(){return T(u)}}else if(void 0===n.deserializer)return void I(a+": Cannot determine type");var l=null==i?void 0:i();void 0!==l&&bt(a,l)||N(t,e,{type:void 0===i?void 0:function(){return T(i())},emitDefaultValue:n.emitDefaultValue,isRequired:n.isRequired,options:V(n),key:e.toString(),name:null!==(o=n.name)&&void 0!==o?o:e.toString(),deserializer:n.deserializer,serializer:n.serializer})};var o=e,i=t,s="@jsonMember on "+j(i.constructor)+"."+String(o);if(C){var a=Reflect.getMetadata("design:type",i,o);if(null!=a){var c=T(a);bt(s,c)||N(i,o,{type:function(){return c},key:e.toString(),name:e.toString()})}else I(s+": could not resolve detected property constructor at runtime. Potential solutions:\n - "+R+"\n - "+E)}else I(s+": ReflectDecorators is required if the type is not explicitly provided with e.g. @jsonMember(Number)")}function mt(t,e){return t instanceof d?t.ctor===e:t===e}function bt(t,e){return e instanceof w||!mt(e,Array)?e instanceof v||!mt(e,Set)?!(e instanceof b||!mt(e,Map)||(I(t+": property is a Map. Use the jsonMapMember decorator to serialize this property."),0)):(I(t+": property is a Set. Use the jsonSetMember decorator to serialize this property."),!0):(I(t+": property is an Array. Use the jsonArrayMember decorator to serialize this property."),!0)}function St(t){var e;function r(t){var r=H.ensurePresentInPrototype(t.prototype);r.isExplicitlyMarked=!0,r.onDeserializedMethodName=e.onDeserialized,r.beforeSerializationMethodName=e.beforeSerialization,null!=e.typeResolver&&(r.typeResolver=e.typeResolver),null!=e.typeHintEmitter&&(r.typeHintEmitter=e.typeHintEmitter),r.initializerCallback=e.initializer,null!=e.name&&(r.name=e.name);var n=V(e);void 0!==n&&(r.options=n),null!=e.knownTypes&&e.knownTypes.filter((function(t){return Boolean(t)})).forEach((function(t){return r.knownTypes.add(t)}))}if(e="function"==typeof t?{}:null!=t?t:{},"function"!=typeof t)return r;r(t)}var zt=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},At=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class Tt{constructor(t,e,r){this.p=e,this.order=r,this.name=t}isCompatPoint(t){if(!this.eq(t.group))throw new Error("points not compatible");return!0}isCompatScalar(t){if(!this.eq(t.group))throw new Error("scalar not compatible");return!0}sizeFieldBytes(){const t=this.p.toString(2).length;return Math.ceil(t/8)}eq(t){return this.name===t.name}newScalar(t){return new Tt.Scalar(this,t)}randomScalar(){return this.newScalar(c(this.order))}deserializeScalar(e){const r=a(e);return t(r,this.order),this.newScalar(r)}}async function Pt(t,e){const r=e.map((t=>t.toBytes())),n=r.map((t=>t.length)).reduce(((t,e)=>t+e)),o=new Uint8Array(n);let i=0;for(const t of r)o.set(t,i),i+=t.length;const s=await crypto.subtle.digest(t,o);return a(new Uint8Array(s).slice(0,10))}zt([vt({constructor:String,isRequired:!0}),At("design:type",String)],Tt.prototype,"name",void 0),function(t){var e;t.Point=class{isCompatPoint(t){return this.group.isCompatPoint(t)}isCompatScalar(t){return this.group.isCompatScalar(t)}static toStringCoords(t){let e="";for(const{name:r,value:n}of t)e+=`${r}:0x${n.toString(16)}\n`;return e}sub(t){return this.add(t.neg())}dblmul(t,e,r){this.isCompatScalar(t),this.isCompatScalar(r),this.isCompatPoint(e);const n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],o=new Map,i=new Map;let s=this.group.identity(),a=e.group.identity();for(const t of n)o.set(t,s),i.set(t,a),s=s.add(this),a=a.add(e);let c=t.base16(),u=r.base16();c.length<u.length&&(c=c.padStart(u.length,"0")),u.length<c.length&&(u=u.padStart(c.length,"0"));let l=this.group.identity();for(let t=0;t<c.length;t++)l=l.dbl(),l=l.dbl(),l=l.dbl(),l=l.dbl(),l=l.add(o.get(c[t])),l=l.add(i.get(u[t]));return l}mul(t){this.isCompatScalar(t);const e=t.base16();let r=this.group.identity();const n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],o=new Map;let i=this.group.identity();for(const t of n)o.set(t,i),i=i.add(this);for(const t of e)r=r.dbl(),r=r.dbl(),r=r.dbl(),r=r.dbl(),r=r.add(o.get(t));return r}};let r=e=class{constructor(t,e){this.group=t,this.k=e?n(e,t.order):BigInt(0)}toString(){return this.reduce(),"0x"+this.k.toString(16)}bits(){return this.reduce(),this.k.toString(2)}base16(){return this.k.toString(16)}eq(t){return this.reduce(),t.reduce(),this.group.eq(t.group)&&this.k===t.k}add(t){return new e(this.group,this.k+t.k)}sub(t){return new e(this.group,this.k-t.k)}mul(t){return new e(this.group,this.k*t.k)}neg(){return new e(this.group,-this.k)}toBytes(){return this.reduce(),s(this.k,this.group.sizeFieldBytes())}isOne(){return this.k===BigInt(1)}isZero(){return this.k===BigInt(0)}cmp(t){return this.k<t.k?-1:this.k>t.k?1:0}reduce(){this.k=n(this.k,this.group.order)}};zt([vt({constructor:t,isRequired:!0}),At("design:type",t)],r.prototype,"group",void 0),zt([vt(u),At("design:type",BigInt)],r.prototype,"k",void 0),r=e=zt([St({beforeSerialization:"reduce"}),gt,At("design:paramtypes",[t,BigInt])],r),t.Scalar=r}(Tt||(Tt={}));var Rt,Et=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},_t=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Bt=class extends Tt{constructor(e,r,n,o,i,s){super(e,r,i),this.name=e,this.p=r,this.a=n,this.d=o,this.order=i,this.gen=s,this._brandTEdwards="",t(n,r),t(o,r),t(s[0],r),t(s[1],r);const a=this.generator();if(!this.isOnGroup(a))throw new Error("generator not on group")}identity(){return new It(this,BigInt(0),BigInt(1))}generator(){return new It(this,this.gen[0],this.gen[1],n(this.gen[0]*this.gen[1],this.p),BigInt(1))}isOnGroup(t){const{p:e,a:r,d:o}=this,{x:i,y:s,t:a,z:c}=t,u=(r*(i*i%e)+s*s%e)%e,l=(c*c%e+o*(a*a%e))%e,p=i*s%e,f=c*a%e;return this.eq(t.group)&&n(u-l,e)===BigInt(0)&&n(p-f,e)===BigInt(0)}sizePointBytes(){return 1+2*this.sizeFieldBytes()}deserializePoint(e){if(e.length===this.sizePointBytes()&&4===e[0]){const r=this.sizeFieldBytes(),o=a(e.slice(1,1+r)),i=a(e.slice(1+r));t(o,this.p),t(i,this.p);const s=n(o*i,this.p),c=new It(this,o,i,s,BigInt(1));if(!this.isOnGroup(c))throw new Error(`point not on TEdwards group: ${this.name} `);return c}throw new Error("error deserializing TEdwardsPoint")}};Bt=Et([gt,_t("design:paramtypes",[String,BigInt,BigInt,BigInt,BigInt,Array])],Bt);let It=Rt=class extends Tt.Point{constructor(t,e,r,n,o){super(),this._brandTEdwardsPoint="",this.group=t,this.x=e,this.y=r,this.t=void 0!==n?n:e*r,this.z=void 0!==o?o:BigInt(1)}toString(){return Tt.Point.toStringCoords([{name:"x",value:this.x},{name:"y",value:this.y},{name:"t",value:this.t},{name:"z",value:this.z}])}isIdentity(){return this.x===BigInt(0)&&this.y!==BigInt(0)&&this.t===BigInt(0)&&this.z!==BigInt(0)&&this.y===this.z}eq(t){const{group:e,x:r,y:o,z:i}=this,{group:s,x:a,y:c,z:u}=t,l=n(r*u,e.p),p=n(a*i,e.p),f=n(o*u,e.p),y=n(c*i,e.p);return e.eq(s)&&l===p&&f===y}neg(){const t=n(-this.x,this.group.p),e=n(-this.t,this.group.p);return new Rt(this.group,t,this.y,e,this.z)}dbl(){const{x:t,y:e,z:r}=this,{p:o,a:i}=this.group,s=t*t%o,a=e*e%o,c=r*r,u=i*s%o,l=t+e,p=(l*l-s-a)%o,f=(u+a)%o,y=(f-(c+c)%o)%o,d=(u-a)%o,h=n(p*y,o),g=n(f*d,o),w=n(p*d,o),v=n(y*f,o);return new Rt(this.group,h,g,w,v)}add(t){this.isCompatPoint(t);const{x:e,y:r,t:o,z:i}=this,{x:s,y:a,t:c,z:u}=t,{p:l,a:p,d:f}=this.group,y=e*s%l,d=r*a%l,h=f*o*c%l,g=i*u%l,w=((e+r)%l*((s+a)%l)-y-d)%l,v=(g-h)%l,m=(g+h)%l,b=(d-p*y)%l,S=n(w*v,l),z=n(m*b,l),A=n(w*b,l),T=n(v*m,l);return new Rt(this.group,S,z,A,T)}toAffine(){const t=i(this.z,this.group.p),e=n(this.x*t,this.group.p),r=n(this.y*t,this.group.p);return this.x=e,this.y=r,this.t=n(e*r,this.group.p),this.z=BigInt(1),{x:e,y:r}}toBytes(){const{x:t,y:e}=this.toAffine(),r=this.group.sizeFieldBytes(),n=new Uint8Array(this.group.sizePointBytes());return n[0]=4,n.set(s(t,r),1),n.set(s(e,r),1+r),n}afterJson(){if(this.t=n(this.x*this.y,this.group.p),!this.group.isOnGroup(this))throw new Error(`point not on TEdwards group: ${this.group.name} `)}};Et([vt({constructor:Tt,isRequired:!0}),_t("design:type",Bt)],It.prototype,"group",void 0),Et([vt(u),_t("design:type",BigInt)],It.prototype,"x",void 0),Et([vt(u),_t("design:type",BigInt)],It.prototype,"y",void 0),It=Rt=Et([St({beforeSerialization:"toAffine",onDeserialized:"afterJson"}),gt,_t("design:paramtypes",[Bt,BigInt,BigInt,BigInt,BigInt])],It),St({knownTypes:[Bt]})(Tt),St({knownTypes:[It]})(Tt.Point);var kt,qt=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},xt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Ct=class extends Tt{constructor(e,r,o,i,s,a){if(super(e,r,s),this.name=e,this.p=r,this.a=o,this.b=i,this.order=s,this.gen=a,this._brandWeierstrassGroup="",t(o,r),t(i,r),t(a[0],r),t(a[1],r),n(o,r)!==r-BigInt(3))throw new Error("only supports a=-3");const c=this.generator();if(!this.isOnGroup(c))throw new Error("generator not on group")}identity(){return new jt(this,BigInt(0),BigInt(1),BigInt(0))}generator(){return new jt(this,this.gen[0],this.gen[1],BigInt(1))}isOnGroup(t){const{p:e,a:r,b:o}=this,{x:i,y:s,z:a}=t,c=a*a%e,u=n(s*s%e*a%e-(i*i*i%e+r*i%e*c%e+o*(c*a%e)%e),e);return this.eq(t.group)&&u===BigInt(0)}sizePointBytes(){return 1+2*this.sizeFieldBytes()}deserializePoint(t){if(1===t.length&&0===t[0])return this.identity();if(t.length===this.sizePointBytes()&&4===t[0]){const e=this.sizeFieldBytes(),r=a(t.slice(1,1+e)),n=a(t.slice(1+e)),o=new jt(this,r,n);if(!this.isOnGroup(o))throw new Error("point not in group");return o}throw new Error("error deserializing Point")}};Ct=qt([gt,xt("design:paramtypes",[String,BigInt,BigInt,BigInt,BigInt,Array])],Ct);let jt=kt=class extends Tt.Point{constructor(t,e,r,n){super(),this._brandWeierstrassPoint="",this.group=t,this.x=e,this.y=r,this.z=void 0!==n?n:BigInt(1)}toString(){return Tt.Point.toStringCoords([{name:"x",value:this.x},{name:"y",value:this.y},{name:"z",value:this.z}])}isIdentity(){return this.x===BigInt(0)&&this.y!==BigInt(0)&&this.z===BigInt(0)}eq(t){const{group:e,x:r,y:n,z:o}=this,{group:i,x:s,y:a,z:c}=t,u=r*c%e.p,l=s*o%e.p,p=n*c%e.p,f=a*o%e.p;return e.eq(i)&&u===l&&p===f}neg(){const t=n(-this.y,this.group.p);return new kt(this.group,this.x,t,this.z)}dbl(){const{x:t,y:e,z:r}=this,{p:o,b:i}=this.group;let s,a,c,u,l,p;s=t*t%o;const f=e*e%o;return a=r*r%o,c=t*e%o,c=(c+c)%o,p=t*r%o,p=(p+p)%o,l=i*a%o,l=(l-p)%o,u=(l+l)%o,l=(u+l)%o,u=(f-l)%o,l=(f+l)%o,l=u*l%o,u=u*c%o,c=(a+a)%o,a=(a+c)%o,p=i*p%o,p=(p-a)%o,p=(p-s)%o,c=(p+p)%o,p=(p+c)%o,c=(s+s)%o,s=(c+s)%o,s=(s-a)%o,s=s*p%o,l=(l+s)%o,s=e*r%o,s=(s+s)%o,p=s*p%o,u=(u-p)%o,p=s*f%o,p=(p+p)%o,p=(p+p)%o,u=n(u,o),l=n(l,o),p=n(p,o),new kt(this.group,u,l,p)}add(t){this.isCompatPoint(t);const{x:e,y:r,z:o}=this,{x:i,y:s,z:a}=t,{p:c,b:u}=this.group;let l,p,f,y,d,h,g,w;return l=e*i%c,p=r*s%c,f=o*a%c,y=(e+r)%c,d=(i+s)%c,y=y*d%c,d=(l+p)%c,y=(y-d)%c,d=(r+o)%c,h=(s+a)%c,d=d*h%c,h=(p+f)%c,d=(d-h)%c,h=(e+o)%c,g=(i+a)%c,h=h*g%c,g=(l+f)%c,g=(h-g)%c,w=u*f%c,h=(g-w)%c,w=(h+h)%c,h=(h+w)%c,w=(p-h)%c,h=(p+h)%c,g=u*g%c,p=(f+f)%c,f=(p+f)%c,g=(g-f)%c,g=(g-l)%c,p=(g+g)%c,g=(p+g)%c,p=(l+l)%c,l=(p+l)%c,l=(l-f)%c,p=d*g%c,f=l*g%c,g=h*w%c,g=(g+f)%c,h=y*h%c,h=(h-p)%c,w=d*w%c,p=y*l%c,w=(w+p)%c,h=n(h,c),g=n(g,c),w=n(w,c),new kt(this.group,h,g,w)}toAffine(){if(this.isIdentity())return this.y=BigInt(1),!1;const t=i(this.z,this.group.p),e=n(this.x*t,this.group.p),r=n(this.y*t,this.group.p);return this.x=e,this.y=r,this.z=BigInt(1),{x:e,y:r}}toBytes(){const t=this.toAffine();if(!t)return new Uint8Array(1);const e=this.group.sizeFieldBytes(),r=new Uint8Array(this.group.sizePointBytes());return r[0]=4,r.set(s(t.x,e),1),r.set(s(t.y,e),1+e),r}afterJson(){if(!this.group.isOnGroup(this))throw new Error(`point not on Weierstrass group: ${this.group.name}`)}};qt([vt({constructor:Tt,isRequired:!0}),xt("design:type",Ct)],jt.prototype,"group",void 0),qt([vt(u),xt("design:type",BigInt)],jt.prototype,"x",void 0),qt([vt(u),xt("design:type",BigInt)],jt.prototype,"y",void 0),jt=kt=qt([St({beforeSerialization:"toAffine",onDeserialized:"afterJson"}),gt,xt("design:paramtypes",[Ct,BigInt,BigInt,BigInt])],jt),St({knownTypes:[Ct]})(Tt),St({knownTypes:[jt]})(Tt.Point);const Ot=new Ct("p256",BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),[BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")]),Mt=new Ct("war256",BigInt("0xffffffff0000000100000000000000017e72b42b30e7317793135661b1c4b117"),BigInt("0xffffffff0000000100000000000000017e72b42b30e7317793135661b1c4b114"),BigInt("0xb441071b12f4a0366fb552f8e21ed4ac36b06aceeb354224863e60f20219fc56"),BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),[BigInt("0x3"),BigInt("0x5a6dd32df58708e64e97345cbe66600decd9d538a351bb3c30b4954925b1f02d")]),Ht=new Bt("tomEdwards256",BigInt("0x3fffffffc000000040000000000000002ae382c7957cc4ff9713c3d82bc47d3af"),BigInt("0x1abce3fd8e1d7a21252515332a512e09d4249bd5b1ec35e316c02254fe8cedf5d"),BigInt("0x051781d9823abde00ec99295ba542c8b1401874bcbeb9e9c861174c7bca6a02aa"),BigInt("0x0ffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),[BigInt("0x7907055d0a7d4abc3eafdc25d431d9659fbe007ee2d8ddc4e906206ea9ba4fdb"),BigInt("0xbe231cb9f9bf18319c9f081141559b0a33dddccd2221f0464a9cd57081b01a01")]);St({initializer:(t,e)=>{switch(t.name){case Ot.name:return Ot;case Mt.name:return Mt;default:throw new Error(`invalid group name: ${t.name}`)}}})(Ct),St({initializer:(t,e)=>{if(t.name!==Ht.name)throw new Error(`invalid group name: ${t.name} `);return Ht}})(Bt);var Nt=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Dt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class Vt{constructor(t,e){this.p=t,this.r=e}add(t){return new Vt(this.p.add(t.p),this.r.add(t.r))}mul(t){const e=this.p.group.newScalar(t);return new Vt(this.p.mul(e),this.r.mul(e))}sub(t){return new Vt(this.p.sub(t.p),this.r.sub(t.r))}}let Kt=class{constructor(t,e,r){this.c=t,this.g=e,this.h=r}eq(t){return this.c.eq(t.c)&&this.g.eq(t.g)&&this.h.eq(t.h)}commit(t){const e=this.c.randomScalar(),r=this.c.newScalar(t),n=this.h.dblmul(e,this.g,r);return new Vt(n,e)}};function Jt(t,e){e||(e=t.generator());const r=t.randomScalar(),n=e.mul(r);return new Kt(t,e,n)}Nt([vt({constructor:Tt,isRequired:!0}),Dt("design:type",Tt)],Kt.prototype,"c",void 0),Nt([vt({constructor:Tt.Point,isRequired:!0}),Dt("design:type",Tt.Point)],Kt.prototype,"g",void 0),Nt([vt({constructor:Tt.Point,isRequired:!0}),Dt("design:type",Tt.Point)],Kt.prototype,"h",void 0),Kt=Nt([St,gt,Dt("design:paramtypes",[Tt,Tt.Point,Tt.Point])],Kt);var Ft=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Ut=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Gt=class{constructor(t,e,r,n,o){this.A_1=t,this.A_2=e,this.t_x=r,this.t_r1=n,this.t_r2=o}eq(t){return this.A_1.eq(t.A_1)&&this.A_2.eq(t.A_2)&&this.t_x.eq(t.t_x)&&this.t_r1.eq(t.t_r1)&&this.t_r2.eq(t.t_r2)}};async function Wt(t,e,r,n){const o=c(t.c.order),i=t.commit(o),s=t.commit(o),a=await Pt("SHA-256",[r.p,n.p,i.p,s.p]),u=t.c.newScalar(a),l=t.c.newScalar(e),p=t.c.newScalar(o).sub(u.mul(l)),f=i.r.sub(u.mul(r.r)),y=s.r.sub(u.mul(n.r));return new Gt(i.p,s.p,p,f,y)}Ft([vt({constructor:Tt.Point,isRequired:!0}),Ut("design:type",Tt.Point)],Gt.prototype,"A_1",void 0),Ft([vt({constructor:Tt.Point,isRequired:!0}),Ut("design:type",Tt.Point)],Gt.prototype,"A_2",void 0),Ft([vt({constructor:Tt.Scalar,isRequired:!0}),Ut("design:type",Tt.Scalar)],Gt.prototype,"t_x",void 0),Ft([vt({constructor:Tt.Scalar,isRequired:!0}),Ut("design:type",Tt.Scalar)],Gt.prototype,"t_r1",void 0),Ft([vt({constructor:Tt.Scalar,isRequired:!0}),Ut("design:type",Tt.Scalar)],Gt.prototype,"t_r2",void 0),Gt=Ft([St,gt,Ut("design:paramtypes",[Tt.Point,Tt.Point,Tt.Scalar,Tt.Scalar,Tt.Scalar])],Gt);var $t=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Lt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Xt=class{constructor(t,e,r,n,o,i,s,a,c,u,l,p,f){this.C_4=t,this.A_x=e,this.A_y=r,this.A_z=n,this.A_4_1=o,this.A_4_2=i,this.t_x=s,this.t_y=a,this.t_z=c,this.t_rx=u,this.t_ry=l,this.t_rz=p,this.t_r4=f}eq(t){return this.C_4.eq(t.C_4)&&this.A_x.eq(t.A_x)&&this.A_y.eq(t.A_y)&&this.A_z.eq(t.A_z)&&this.A_4_1.eq(t.A_4_1)&&this.A_4_2.eq(t.A_4_2)&&this.t_x.eq(t.t_x)&&this.t_y.eq(t.t_y)&&this.t_z.eq(t.t_z)&&this.t_rx.eq(t.t_rx)&&this.t_ry.eq(t.t_ry)&&this.t_rz.eq(t.t_rz)&&this.t_r4.eq(t.t_r4)}};async function Yt(t,e,r,n,o,i,s){const a=t.c.newScalar(e),u=i.p.mul(a),l=i.r.mul(a),p=c(t.c.order),f=c(t.c.order),y=c(t.c.order),d=t.c.newScalar(p),h=t.commit(p),g=t.commit(f),w=t.commit(y),v=t.commit(y),m=i.p.mul(d),b=await Pt("SHA-256",[o.p,i.p,s.p,u,h.p,g.p,w.p,v.p,m]),S=t.c.newScalar(b),z=t.c.newScalar(f),A=t.c.newScalar(y),T=t.c.newScalar(r),P=t.c.newScalar(n),R=d.sub(S.mul(a)),E=z.sub(S.mul(T)),_=A.sub(S.mul(P)),B=h.r.sub(S.mul(o.r)),I=g.r.sub(S.mul(i.r)),k=w.r.sub(S.mul(s.r)),q=v.r.sub(S.mul(l));return new Xt(u,h.p,g.p,w.p,v.p,m,R,E,_,B,I,k,q)}$t([vt({constructor:Tt.Point,isRequired:!0}),Lt("design:type",Tt.Point)],Xt.prototype,"C_4",void 0),$t([vt({constructor:Tt.Point,isRequired:!0}),Lt("design:type",Tt.Point)],Xt.prototype,"A_x",void 0),$t([vt({constructor:Tt.Point,isRequired:!0}),Lt("design:type",Tt.Point)],Xt.prototype,"A_y",void 0),$t([vt({constructor:Tt.Point,isRequired:!0}),Lt("design:type",Tt.Point)],Xt.prototype,"A_z",void 0),$t([vt({constructor:Tt.Point,isRequired:!0}),Lt("design:type",Tt.Point)],Xt.prototype,"A_4_1",void 0),$t([vt({constructor:Tt.Point,isRequired:!0}),Lt("design:type",Tt.Point)],Xt.prototype,"A_4_2",void 0),$t([vt({constructor:Tt.Scalar,isRequired:!0}),Lt("design:type",Tt.Scalar)],Xt.prototype,"t_x",void 0),$t([vt({constructor:Tt.Scalar,isRequired:!0}),Lt("design:type",Tt.Scalar)],Xt.prototype,"t_y",void 0),$t([vt({constructor:Tt.Scalar,isRequired:!0}),Lt("design:type",Tt.Scalar)],Xt.prototype,"t_z",void 0),$t([vt({constructor:Tt.Scalar,isRequired:!0}),Lt("design:type",Tt.Scalar)],Xt.prototype,"t_rx",void 0),$t([vt({constructor:Tt.Scalar,isRequired:!0}),Lt("design:type",Tt.Scalar)],Xt.prototype,"t_ry",void 0),$t([vt({constructor:Tt.Scalar,isRequired:!0}),Lt("design:type",Tt.Scalar)],Xt.prototype,"t_rz",void 0),$t([vt({constructor:Tt.Scalar,isRequired:!0}),Lt("design:type",Tt.Scalar)],Xt.prototype,"t_r4",void 0),Xt=$t([St,gt,Lt("design:paramtypes",[Tt.Point,Tt.Point,Tt.Point,Tt.Point,Tt.Point,Tt.Point,Tt.Scalar,Tt.Scalar,Tt.Scalar,Tt.Scalar,Tt.Scalar,Tt.Scalar,Tt.Scalar])],Xt);var Qt=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Zt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let te=class{constructor(t,e,r,n,o,i,s,a,c,u){this.C_8=t,this.C_10=e,this.C_11=r,this.C_13=n,this.pi_8=o,this.pi_10=i,this.pi_11=s,this.pi_13=a,this.pi_x=c,this.pi_y=u}eq(t){return this.C_8.eq(t.C_8)&&this.C_10.eq(t.C_10)&&this.C_11.eq(t.C_11)&&this.C_13.eq(t.C_13)&&this.pi_8.eq(t.pi_8)&&this.pi_10.eq(t.pi_10)&&this.pi_11.eq(t.pi_11)&&this.pi_13.eq(t.pi_13)&&this.pi_x.eq(t.pi_x)&&this.pi_y.eq(t.pi_y)}};async function ee(t,e,r,o,s,a,c,u,l,p){if(!e.add(r).eq(o))throw Error("Points don't add up!");const f=t.c.order,y=s,d=c,h=l,g=a,w=u,v=p,m=e.toAffine(),b=r.toAffine(),S=o.toAffine();if(!m)throw new Error("P is at infinity");if(!b)throw new Error("Q is at infinity");if(!S)throw new Error("R is at infinity");const{x:z,y:A}=m,{x:T,y:P}=b,{x:R}=S,E=n(T-z,f),_=i(E,f),B=n(P-A,f),I=n(_*B,f),k=n(I*I,f),q=n(z-R,f),x=n(I*q,f),C=d.sub(y),j=t.commit(_),O=w.sub(g),M=t.commit(I),H=t.commit(k),N=y.sub(h),D=t.commit(x),V=new Vt(t.g,t.c.newScalar(BigInt(0))),K=await Yt(t,E,_,BigInt(1),C,j,V),J=await Yt(t,_,B,I,j,O,M),F=await Yt(t,I,I,k,M,M,H);let U=new Vt(h.p.add(y.p).add(d.p),h.r.add(y.r).add(d.r));const G=await Wt(t,k,H,U),W=await Yt(t,I,q,x,M,N,D);U=new Vt(v.p.add(g.p),v.r.add(g.r));const $=await Wt(t,x,D,U);return new te(j.p,M.p,H.p,D.p,K,J,F,W,G,$)}Qt([vt({constructor:Tt.Point,isRequired:!0}),Zt("design:type",Tt.Point)],te.prototype,"C_8",void 0),Qt([vt({constructor:Tt.Point,isRequired:!0}),Zt("design:type",Tt.Point)],te.prototype,"C_10",void 0),Qt([vt({constructor:Tt.Point,isRequired:!0}),Zt("design:type",Tt.Point)],te.prototype,"C_11",void 0),Qt([vt({constructor:Tt.Point,isRequired:!0}),Zt("design:type",Tt.Point)],te.prototype,"C_13",void 0),Qt([vt({constructor:Xt,isRequired:!0}),Zt("design:type",Xt)],te.prototype,"pi_8",void 0),Qt([vt({constructor:Xt,isRequired:!0}),Zt("design:type",Xt)],te.prototype,"pi_10",void 0),Qt([vt({constructor:Xt,isRequired:!0}),Zt("design:type",Xt)],te.prototype,"pi_11",void 0),Qt([vt({constructor:Xt,isRequired:!0}),Zt("design:type",Xt)],te.prototype,"pi_13",void 0),Qt([vt({constructor:Gt,isRequired:!0}),Zt("design:type",Gt)],te.prototype,"pi_x",void 0),Qt([vt({constructor:Gt,isRequired:!0}),Zt("design:type",Gt)],te.prototype,"pi_y",void 0),te=Qt([St,gt,Zt("design:paramtypes",[Tt.Point,Tt.Point,Tt.Point,Tt.Point,Xt,Xt,Xt,Xt,Gt,Gt])],te);var re=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ne=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let oe=class{constructor(t,e,r,n,o,i,s,a,c,u,l,p){this.A=t,this.Tx=e,this.Ty=r,this.alpha=n,this.beta1=o,this.beta2=i,this.beta3=s,this.z=a,this.z2=c,this.proof=u,this.r1=l,this.r2=p}eq(t){const e=this.A.eq(t.A)&&this.Tx.eq(t.Tx)&&this.Ty.eq(t.Ty),r=!(!this.alpha||!t.alpha)&&this.alpha.eq(t.alpha)&&!(!this.beta1||!t.beta1)&&this.beta1.eq(t.beta1)&&!(!this.beta2||!t.beta2)&&this.beta2.eq(t.beta2)&&!(!this.beta3||!t.beta3)&&this.beta3.eq(t.beta3),n=!(!this.z||!t.z)&&this.z.eq(t.z)&&!(!this.z2||!t.z2)&&this.z2.eq(t.z2)&&!(!this.proof||!t.proof)&&this.proof.eq(t.proof)&&!(!this.r1||!t.r1)&&this.r1.eq(t.r1)&&!(!this.r2||!t.r2)&&this.r2.eq(t.r2);return e&&(r||n)}};function ie(t,e){return t.length===e.length&&t.every(((t,r)=>t.eq(e[r])))}function se(t,e,r){let o=BigInt(0);for(let i=t.length-1;i>=0;i--)o=n(t[i]+e*o,r);return o}re([vt({constructor:Tt.Point,isRequired:!0}),ne("design:type",Tt.Point)],oe.prototype,"A",void 0),re([vt({constructor:Tt.Point,isRequired:!0}),ne("design:type",Tt.Point)],oe.prototype,"Tx",void 0),re([vt({constructor:Tt.Point,isRequired:!0}),ne("design:type",Tt.Point)],oe.prototype,"Ty",void 0),re([vt({constructor:Tt.Scalar}),ne("design:type",Tt.Scalar)],oe.prototype,"alpha",void 0),re([vt({constructor:Tt.Scalar}),ne("design:type",Tt.Scalar)],oe.prototype,"beta1",void 0),re([vt({constructor:Tt.Scalar}),ne("design:type",Tt.Scalar)],oe.prototype,"beta2",void 0),re([vt({constructor:Tt.Scalar}),ne("design:type",Tt.Scalar)],oe.prototype,"beta3",void 0),re([vt({constructor:Tt.Scalar}),ne("design:type",Tt.Scalar)],oe.prototype,"z",void 0),re([vt({constructor:Tt.Scalar}),ne("design:type",Tt.Scalar)],oe.prototype,"z2",void 0),re([vt({constructor:te}),ne("design:type",te)],oe.prototype,"proof",void 0),re([vt({constructor:Tt.Scalar}),ne("design:type",Tt.Scalar)],oe.prototype,"r1",void 0),re([vt({constructor:Tt.Scalar}),ne("design:type",Tt.Scalar)],oe.prototype,"r2",void 0),oe=re([St,gt,ne("design:paramtypes",[Tt.Point,Tt.Point,Tt.Point,Tt.Scalar,Tt.Scalar,Tt.Scalar,Tt.Scalar,Tt.Scalar,Tt.Scalar,te,Tt.Scalar,Tt.Scalar])],oe);var ae=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ce=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let ue=class{constructor(t,e,r,n,o,i,s,a){this.cl=t,this.ca=e,this.cb=r,this.cd=n,this.f=o,this.za=i,this.zb=s,this.zd=a}eq(t){return ie(this.cl,t.cl)&&ie(this.ca,t.ca)&&ie(this.cb,t.cb)&&ie(this.cd,t.cd)&&ie(this.f,t.f)&&ie(this.za,t.za)&&ie(this.zb,t.zb)&&this.zd.eq(t.zd)}};function le(t,e,r){const o=n(e,t.c.order),i=n(r,t.c.order);return t.g.dblmul(t.c.newScalar(o),t.h,t.c.newScalar(i))}async function pe(t,e,r,s){const a=function(t,e){const r=[];for(let n=0;n<t.length;n++)r[n]=e.newScalar(t[n]);const n=2**Math.ceil(Math.log2(t.length));for(let e=t.length;e<n;e++)r.push(r[0]);return r}(s,t.c),u=t.c,l=BigInt(r),p=Math.ceil(Math.log2(a.length)),f=[];let y=l;for(let t=0;t<p;t++)f[t]=y%BigInt(2),y/=BigInt(2);const d=[],h=[],g=[],w=[],v=[];for(let t=0;t<p;t++)d[t]=c(u.order),h[t]=c(u.order),g[t]=c(u.order),w[t]=c(u.order),v[t]=c(u.order);const m=[],b=[],S=[],z=[];for(let e=0;e<p;e++)m[e]=le(t,f[e],d[e]),b[e]=le(t,h[e],g[e]),S[e]=le(t,f[e]*h[e],w[e]);const A=[];for(let t=0;t<p;t++)A[t]=BigInt(t);const T=[];for(const t of A){const e=[],o=[],s=[];for(let r=0;r<p;r++)e[r]=n((BigInt(1)-f[r])*t-h[r],u.order),o[r]=n(f[r]*t+h[r],u.order),s[r]=n(o[r]*i(e[r],u.order),u.order);let c=BigInt(1);for(let t=0;t<e.length;t++)c*=e[t],c=n(c,u.order);const l=[];l[0]=c;for(let t=0;t<p;t++){const e=l.length;for(let r=0;r<e;r++)l[e+r]=n(s[t]*l[r],u.order)}let y=BigInt(0);for(let t=0;t<a.length;t++)y+=(a[r].k-a[t].k)*l[t],y=n(y,u.order);T.push(y)}const P=function(t,e,r){if(t.length!=e.length)throw new Error("inconsistent args");const o=t.length,s=[],a=[];for(let t=0;t<o;t++)s[t]=BigInt(0),a[t]=BigInt(0);s[o]=BigInt(1),s[o-1]=-t[0]%r;for(let e=1;e<o;e++){for(let n=o-e-1;n<o-1;n++)s[n]=(s[n]-t[e]*s[n+1])%r;s[o-1]=(s[o-1]-t[e])%r}for(let c=0;c<o;c++){let u=BigInt(0);for(let e=o;e>=1;e--)u=BigInt(e)*s[e]+t[c]*u;u=n(u,r);const l=i(u,r)%r;let p=BigInt(1);for(let i=o-1;i>=0;i--)a[i]=n(a[i]+p*l*e[c],r),p=s[i]+t[c]*p}for(let n=0;n<o;n++)if(e[n]!=se(a,t[n],r))throw new Error("incorrect interpolation");return a}(A,T,u.order);for(let e=0;e<p;e++)z[e]=le(t,P[e],v[e]);const R=m.concat(b).concat(S).concat(z),E=await Pt("SHA-256",R),_=[],B=[],I=[];let k=e.r.k*o(E,BigInt(p),u.order)%u.order;for(let t=0;t<p;t++)_[t]=u.newScalar(n(f[t]*E+h[t],u.order)),B[t]=u.newScalar(n(d[t]*E+g[t],u.order)),I[t]=u.newScalar(n(d[t]*(E-_[t].k)+w[t],u.order));for(let t=0;t<p;t++)k=n(k-v[t]*o(E,BigInt(t),u.order),u.order);return new ue(m,b,S,z,_,B,I,u.newScalar(k))}ae([it(Tt.Point,{isRequired:!0}),ce("design:type",Array)],ue.prototype,"cl",void 0),ae([it(Tt.Point,{isRequired:!0}),ce("design:type",Array)],ue.prototype,"ca",void 0),ae([it(Tt.Point,{isRequired:!0}),ce("design:type",Array)],ue.prototype,"cb",void 0),ae([it(Tt.Point,{isRequired:!0}),ce("design:type",Array)],ue.prototype,"cd",void 0),ae([it(Tt.Scalar,{isRequired:!0}),ce("design:type",Array)],ue.prototype,"f",void 0),ae([it(Tt.Scalar,{isRequired:!0}),ce("design:type",Array)],ue.prototype,"za",void 0),ae([it(Tt.Scalar,{isRequired:!0}),ce("design:type",Array)],ue.prototype,"zb",void 0),ae([vt({constructor:Tt.Scalar,isRequired:!0}),ce("design:type",Tt.Scalar)],ue.prototype,"zd",void 0),ue=ae([St,gt,ce("design:paramtypes",[Array,Array,Array,Array,Array,Array,Array,Tt.Scalar])],ue);var fe=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ye=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let de=class{constructor(t,e,r,n,o,i){this.R=t,this.comS1=e,this.keyXcom=r,this.keyYcom=n,this.expProof=o,this.membershipProof=i}eq(t){return this.R.eq(t.R)&&this.comS1.eq(t.comS1)&&this.keyXcom.eq(t.keyXcom)&&this.keyYcom.eq(t.keyYcom)&&ie(this.expProof,t.expProof)&&this.membershipProof.eq(t.membershipProof)}};fe([vt({constructor:Tt.Point,isRequired:!0}),ye("design:type",Tt.Point)],de.prototype,"R",void 0),fe([vt({constructor:Tt.Point,isRequired:!0}),ye("design:type",Tt.Point)],de.prototype,"comS1",void 0),fe([vt({constructor:Tt.Point,isRequired:!0}),ye("design:type",Tt.Point)],de.prototype,"keyXcom",void 0),fe([vt({constructor:Tt.Point,isRequired:!0}),ye("design:type",Tt.Point)],de.prototype,"keyYcom",void 0),fe([it(oe,{isRequired:!0}),ye("design:type",Array)],de.prototype,"expProof",void 0),fe([vt({constructor:ue,isRequired:!0}),ye("design:type",ue)],de.prototype,"membershipProof",void 0),de=fe([St,gt,ye("design:paramtypes",[Tt.Point,Tt.Point,Tt.Point,Tt.Point,Array,ue])],de);let he=class{constructor(t,e,r){this.NistGroup=t,this.ProofGroup=e,this.SecLevel=r}eq(t){return this.NistGroup.eq(t.NistGroup)&&this.ProofGroup.eq(t.ProofGroup)&&this.SecLevel==t.SecLevel}};function ge(t=80){const e=Jt(Ot),r=Jt(Ht);return new he(e,r,t)}async function we(t,o,s,c,u,l){const p=Ot,f=new Uint8Array(await crypto.subtle.exportKey("raw",c)),y=Ot.deserializePoint(f),d=y.toAffine();if(!d)throw new Error("invalid public key");const h=s.length,g=p.order,w=function(t,r){const n=e(t)-e(r);return n>0&&(t>>=BigInt(n)),t}(a(o),g),v=a(s.slice(0,h/2)),m=a(s.slice(h/2)),b=i(m,g),S=n(b*w,g),z=n(b*v,g),A=p.generator().mul(p.newScalar(S)).add(y.mul(p.newScalar(z))),T=i(v,g),P=n(T*m,g),R=n(T*w,g),E=p.generator().mul(p.newScalar(R)),_=new Kt(Ot,A,t.NistGroup.h),B=_.commit(P),I=t.ProofGroup.commit(d.x),k=t.ProofGroup.commit(d.y),q=await async function(t,e,n,o,i,s,a,c,u){const l=new Array(c),p=new Array(c),f=new Array(c),y=new Array(c),d=new Array(c),h=new Array(c);for(let r=0;r<c;r++){l[r]=t.c.randomScalar(),p[r]=t.c.randomScalar(),f[r]=t.g.mul(l[r]),y[r]=f[r].add(t.h.mul(p[r]));const n=f[r].toAffine();if(!n)throw new Error("T[i] is at infinity");const{x:o,y:i}=n;d[r]=e.commit(o),h[r]=e.commit(i)}const g=[s.p,a.p];for(let t=0;t<c;t++)g.push(y[t]),g.push(d[t].p),g.push(h[t].p);let w=await Pt("SHA-256",g);const v=new Array(c);let m;for(let g=0;g<c;g++){if(r(w))m=new oe(y[g],d[g].p,h[g].p,l[g],p[g],d[g].r,h[g].r,void 0,void 0,void 0,void 0,void 0);else{const r=l[g].sub(t.c.newScalar(n));let c=t.g.mul(r);u&&(c=c.add(u));const w=c.toAffine();if(!w)throw new Error("T1 is at infinity");const{x:v,y:b}=w,S=e.commit(v),z=e.commit(b),A=await ee(e,c,i,f[g],S,z,s,a,d[g],h[g]);m=new oe(y[g],d[g].p,h[g].p,void 0,void 0,void 0,void 0,r,p[g].sub(o.r),A,S.r,z.r)}v[g]=m,w>>=BigInt(1)}return v}(_,t.ProofGroup,P,B,y,I,k,t.SecLevel,E),x=await pe(t.ProofGroup,I,u,l);return new de(A,B.p,I.p,k.p,q,x)}function ve(t){localStorage.setItem("keyPair",t)}function me(t,e,r){t.disabled=!0,e.disabled=!0,r.disabled=!0}async function be(t,e,r,n,o){let i;for(let t=1;t<o.length;t++)if(n.publicKey===o[t]){i=t;break}console.log("user key "+o[i]+" found at "+i);const s=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n.privateKey,(new TextEncoder).encode(t.toString())),a=ge(),c=await window.crypto.subtle.digest("SHA-256",(new TextEncoder).encode(t.toString())),u={blockId:r,vote:e,idProof:await we(a,new Uint8Array(c),new Uint8Array(s),n.publicKey,i,o)},l=JSON.stringify(u,null,2),p=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n.privateKey,(new TextEncoder).encode(l)),f=ge(),y=await window.crypto.subtle.digest("SHA-256",(new TextEncoder).encode(l));return{voteBlock:u,proof:await we(f,new Uint8Array(y),new Uint8Array(p),n.publicKey,i,o)}}fe([vt({constructor:Kt,isRequired:!0}),ye("design:type",Kt)],he.prototype,"NistGroup",void 0),fe([vt({constructor:Kt,isRequired:!0}),ye("design:type",Kt)],he.prototype,"ProofGroup",void 0),fe([vt({constructor:Number,isRequired:!0}),ye("design:type",Number)],he.prototype,"SecLevel",void 0),he=fe([St,gt,ye("design:paramtypes",[Kt,Kt,Number])],he),window.tryNewVote=async function(){const t=document.getElementById("voteID"),e=document.getElementById("candidateID"),r=document.getElementById("voteCheckButton");document.getElementById("keyCode"),me(t,e,r),generateKeyPair(),ve(generateKeyPair())},window.savePrivateKey=ve,window.onClickDisable=me,window.putInitial=async function(){return fetch("https://put-initial.tjroh01.workers.dev",{method:"POST",body:JSON.stringify({voteOptions:["a","b","c"]})}).then((t=>t.json())).catch((function(t){console.log(t)}))},window.putIdentity=async function(t,e){const r=await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]),n=btoa(JSON.stringify(await window.crypto.subtle.exportKey("jwk",r.publicKey))),o=new Headers;return o.append("vote-id",t.toString()),console.log(JSON.parse(JSON.stringify({publicKey:n,identityString:e}))),fetch("https://put-identity.tjroh01.workers.dev",{method:"POST",headers:o,body:JSON.stringify({publicKey:n,identityString:e})}).then((function(t){console.log(t)})).catch((function(t){console.log(t)}))},window.putBlock=async function(t,e,r,n,o){const i=new Headers;i.append("vote-id",t.toString()),console.log(n.keyring);let s=await be(t,e,o+1,r,n.keyring);return fetch("https://put-block.tjroh01.workers.dev",{method:"POST",headers:i,body:JSON.stringify(s)}).then((t=>t.json())).catch((function(t){console.log(t)}))},window.getInitial=async function(t){return fetch("https://get-initial.tjroh01.workers.dev",{method:"GET",headers:{"vote-id":t}}).then((t=>t.json())).catch((function(t){console.log(t)}))},window.getBlock=async function(t){let e=new Headers;return e.append("vote-id",t.toString()),fetch("https://get-block.tjroh01.workers.dev",{method:"GET",headers:e}).then((t=>t.json())).catch((function(t){console.log(t.json())}))},window.getKeyRing=async function(t){let e=new Headers;return e.append("vote-id",t.toString()),fetch("https://get-keyring.tjroh01.workers.dev",{method:"GET",headers:e}).then((t=>t.json())).catch((function(t){console.log(t.json())}))},window.CreateVoteBlock=be})();